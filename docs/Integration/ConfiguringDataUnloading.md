# Настройка выгрузки данных

Все объекты выгрузки находятся в подсистеме **"Обмен данными ИБ"** - **"Выгрузка"**.

[![1][1]][1]

## Заполнение настроек выгрузки

1. **Получатели**

    В справочнике **"Получатели"** хранится информация о базах получателях и виде транспорта, с помощью которого данные выгружаются в базу приемник.

    Виды транспорта могут быть двух видов:

    - ***Встроенный*** – это обмен через http-сервис. Для него необходимо указать параметры подключения к базе приемнику: сервер, порт, имя публикации, пользователь и пароль для подключения к базе приемнику.

        [![2][2]][2]

    - ***Datareon*** – обмен с использованием шины данных Datareon. Для использования необходимо встроить подсистему Datareon.

        [![3][3]][3]

2. **Активные получатели**

    В регистре хранится список баз в которые происходит выгрузка данных.

    Если получатель создан, но не указан в регистре ***Активные получатели***, то данные в эту базу выгружаться не будут.

    [![4][4]][4]

3. **Правила выгрузки**

    Справочник **"Правила выгрузки"** содержит информацию о получателях, типах передаваемых пакетов, способах отбора, дате начала обмена.

    *Тип пакета* – это тип выгружаемых данных.

    Способов отбора может быть два:

    - Все объекты
    - По условию - условия выгрузки прописываются в конфигураторе. На форму могут быть выведены какие-то дополнительные отборы. Например, список видов номенклатуры для выгрузки или список подразделений, по которым выгружаются документы и т.д.

    [![5][5]][5]

## Выгрузка данных

1. При записи объекта, для которого настроено правило выгрузки, он попадает в **"Объекты к выгрузке"**. В данном регистре хранится информация об объектах ИБ, дате,  виде транспорта.

    [![6][6]][6]

    Также можно добавлять объекты по кнопке **"Добавить"**.

2. Затем нужно обработать *"Объекты к выгрузке"* в соответствии с правилами выгрузки либо кнопкой **"Добавить в очередь"** из формы списка

    [![7][7]][7]

    либо с помощью регламентного задания **"Обмен данными ИБ: Маршрутизация исходящих пакетов"**

    [![8][8]][8]

3. Обработанные объекты попадают в регистр **"Очередь исходящих пакетов"**. Если объект не удовлетворяет условиям ни одного из правил, то он удаляется из **"Объектов к выгрузке"** и не попадает в **"Очередь исходящих пакетов"**.

    [![9][9]][9]

    В регистре **"Очередь исходящих пакетов"** хранится информация о получателях, УИДах пакетов данных , Объектах ИБ, Типах пакетов, Правилах, Приоритетах, датах и хешах объектов ИБ.

    - Тип пакета – тип данных ИБ
    - Получатель – база, в которую будут отправлены данные. При этом, если для данного *Типа пакета* существуют правила для нескольких приемников, то в **Очереди исходящих пакетов** будет столько строк для данного Объекта ИБ, сколько активных получателей указано в правилах выгрузки.
    - Пакет данных УИД – УИД пакета данных, который представляет собой строку в формате json, содержит в себе все данные для выгрузки по Объекту ИБ.
    - Правило – правило выгрузки, по которому был обработан Объект ИБ и сформирован пакет данных для выгрузки.

4. Далее объекты из **"Очереди исходящих пакетов"** базы источника передаются в **"Очередь входящих пакетов"** базы приемника. Это осуществляется либо по кнопке **"Отправить"** из формы списка **Очереди исходящих пакетов**

    [![10][10]][10]

    либо с помощью регламентного задания **"Обмен данными ИБ: Отправка исходящих пакетов"** .

    [![11][11]][11]

    Если выгрузка произошла корректно, то строка из **"Очереди исходящих пакетов"** исчезнет. В противном случае – отобразится информация об ошибке.

    Посмотреть ее можно на форме списка **Исходящего пакета** на вкладке **Журнал**.

    [![12][12]][12]

    Сам пакет данных можно посмотреть на вкладке **Основное**.

    [![13][13]][13]

5. Информация о всех выгруженных пакетах хранится в **"Журнале исходящих пакетов"**

[![14][14]][14]

[1]: ConfiguringDataUnloading.assets/1.png
[2]: ConfiguringDataUnloading.assets/2.png
[3]: ConfiguringDataUnloading.assets/3.png
[4]: ConfiguringDataUnloading.assets/4.png
[5]: ConfiguringDataUnloading.assets/5.png
[6]: ConfiguringDataUnloading.assets/6.png
[7]: ConfiguringDataUnloading.assets/7.png
[8]: ConfiguringDataUnloading.assets/8.png
[9]: ConfiguringDataUnloading.assets/9.png
[10]: ConfiguringDataUnloading.assets/10.png
[11]: ConfiguringDataUnloading.assets/11.png
[12]: ConfiguringDataUnloading.assets/12.png
[13]: ConfiguringDataUnloading.assets/13.png
[14]: ConfiguringDataUnloading.assets/14.png
