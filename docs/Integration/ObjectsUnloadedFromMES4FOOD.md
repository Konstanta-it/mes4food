# Объекты выгружаемые из MES4FOOD

Для выгрузки из MES доступны следующие типы пакетов:

[![1][1]][1]

Для обмена данными в MES4FOOD нужно завести правило выгрузки, а в ERP - правило загрузки для соответствующего пакета.

## Справочники

### партии номенклатуры

Справочник **"партии номенклатуры"** загружается в справочник **"партии номенклатуры"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|ЭтоГруппа|ЭтоГруппа|
|Владелец(Номенклатура)|ВидНоменклатуры = Номенклатура.ВидНоменклатуры|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Наименование|Наименование|
|Номер|Номер|
|ДатаВыпуска|ДатаПроизводства|
|ГоденДо|ГоденДо|

В правиле выгрузки указывается вид номенклатуры.

### Ресурсные спецификации

Справочник **"Ресурсные спецификации для обмена с внешними ИБ обмен данными ИБ"** загружается в справочники **"Ресурсные спецификации"** и **"Этапы производства"** базы ERP.

В справочнике **"Ресурсные спецификации для обмена с внешними ИБ"** указывается элемент справочника **"Ресурсная спецификация"**.

[![2][2]][2]

Сопоставление реквизитов объектов **"Ресурсные спецификации для обмена с внешними ИБ обмен данными ИБ"** и **"Ресурсные спецификации"**:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|ЭтоГруппа|ЭтоГруппа|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Наименование|Наименование|
|Родитель|Родитель|
|ОсновноеИзделиеНоменклатура|ОсновноеИзделиеНоменклатура|
|ОсновноеИзделиеКоличествоУпаковок|ОсновноеИзделиеКоличествоУпаковок|
|*(Этапы)*|МногоэтапныйПроизводственныйПроцесс = Этапы.Количество() > 1|
|НачалоДействия|НачалоДействия|
|КонецДействия|КонецДействия|
||Статус = ВРазработке|
||ТипПроизводственногоПроцесса = Сборка|
||ВариантНазначения = СписокНоменклатуры|
|ВыходныеИзделия.Номенклатура|ВыходныеИзделия.Номенклатура|
|ВыходныеИзделия.Количество|ВыходныеИзделия.КоличествоУпаковок|
|ВыходныеИзделия.КлючСвязиЭтапы|ВыходныеИзделия.Этап|
|ВыходныеИзделия.КлючСвязиЭтапы|ВыходныеИзделия.ЭтапРедактирование|
|ВыходныеИзделия.ДоляСтоимости|ВыходныеИзделия.ДоляСтоимости|
|МатериалыИУслуги.Номенклатура|МатериалыИУслуги.Номенклатура|
|МатериалыИУслуги.Количество|МатериалыИУслуги.КоличествоУпаковок|
|МатериалыИУслуги.КлючСвязиЭтапы|МатериалыИУслуги.Этап|
|МатериалыИУслуги.КлючСвязиЭтапы|МатериалыИУслуги.ЭтапРедактирование|
||МатериалыИУслуги.СпособПолученияМатериала = Обеспечивать|
|Этапы|Загрузка в ЭтапыПроизводства (Справочник)|

Сопоставление реквизитов объектов **"Ресурсные спецификации для обмена с внешними ИБ обмен данными ИБ"** и **"Этапы производства"**:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|КлючСвязи|Ссылка|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Наименование|Наименование|
|Ссылка|Владелец|
|Подразделение|Подразделение|
||ПроизводствоНаСтороне = Ложь|
||ПланироватьРаботуВидовРабочихЦентров = Ложь|
|НомерЭтапа|НомерЭтапа|
|НомерСледующегоЭтапа|НомерСледующегоЭтапа|
||ЕдиницаИзмеренияПредварительногоБуфера = Минута|
||ЕдиницаИзмеренияЗавершающегоБуфера = Минута|

Ресурсная спецификация не должна быть помечена на удаление, в правиле выгрузки указывается статус спецификации.

## Документы

### Распоряжение на перемещение

Документ **"Распоряжение на перемещение"** загружается в документ **"Перемещение товаров"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
||Статус = Принято|
||ХозяйственнаяОперация = ПеремещениеТоваров|
|СкладОтправитель|СкладОтправитель|
|СкладПолучатель|СкладПолучатель|
||Организация = ПравилоЗагрузки.Организация|
|Товары.Номенклатура|Товары.Номенклатура|
|Товары.Количество|Товары.Количество|
|Товары.Номенклатура|партии.Номенклатура|
|Товары.Количество|партии.Количество|
|Товары.партия|партии.партия|

В правиле выгрузки указывается дата, дата документа должна быть больше даты начала обмена в правиле выгрузки.

Склад-отправитель и Склад-получатель не должны быть привязаны к одному Складу внешних ИБ.

!!! info ""

    При выгрузке склады подменяются на к2СкладыВнешнихИБОбменДаннымиИБ. Табличная часть партии заполняется только строками, в которых заполнена партия. После загрузки сворачивается табличная часть Товары.

### Поступления молочного сырья

Документ **"Поступление молочного сырья"** загружается в документ **"Приобретение товаров и услуг"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
|ТоварыЗаявлено.Поставщик|Контрагент|
||Партнер = Контрагент.Партнер|
|ТоварыВзаиморасчеты.Соглашение|Договор|
|ТоварыФакт.Склад|Склад|
||Валюта = Договор.ВалютаВзаиморасчетов|
||ВалютаВзаиморасчетов = Договор.ВалютаВзаиморасчетов|
||СпособДоставки = СиламиПоставщикаДоНашегоСклада|
||ХозяйственнаяОперация = ЗакупкаУПоставщика|
|Ссылка|_ПолученныйДокументСсылка|
||Организация = ПравилоЗагрузки.Организация|
||ВариантПриемкиТоваров = ПравилоЗагрузки.ВариантПриемкиТоваров|
||ЗакупкаПодДеятельность = ПравилоЗагрузки.ЗакупкаПодДеятельность|
||НалогообложениеНДС = ПравилоЗагрузки.НалогообложениеНДС|
|ТоварыФакт.Номенклатура|Товары.Номенклатура|
|ТоварыФакт.партия|Товары.партия|
|ТоварыФакт.ФизическийВес|Товары.Количество|
|ТоварыВзаиморасчеты.Цена|Товары.Цена|
|ТоварыФакт.Склад|Товары.Склад|
|ТоварыФакт.Номенклатура|партии.Номенклатура|
|ТоварыФакт.партия|партии.партия|
|ТоварыФакт.ФизическийВес|партии.Количество|
|ТоварыФакт.Склад|партии.Склад|

В правиле выгрузки указываются Организация и дата, дата документа должна быть больше даты начала обмена в правиле выгрузки. Статус документа = Принято по стоимости.

!!! info ""

    * Создается столько документов, сколько разрезов Склад-Контрагент.
    * Поиск уже созданных документов происходит по реквизиту _ПолученныйДокументСсылка, который равен ГУИДУ в MES4FOOD.
    * При выгрузке склады подменяются на к2СкладыВнешнихИБОбменДаннымиИБ.
    * Связь табличных частей в MES4FOOD по реквизиту КлючСвязиТоварыЗаявлено.
    * Документы, найденные по реквизиту _ПолученныйДокументСсылка, которые были загружены ранее, но не загружались в текущем обмене - помечаются на удаление.

### Акт переработки

Документ **"Акт переработки"** загружается в документы **"Производство без заказа"** и **"Движение продукции и материалов"** базы ERP.

Сопоставление реквизитов объектов **"Акт переработки"** и **"Производство без заказа"**.

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
|Подразделение|Подразделение|
||Организация = ПравилоЗагрузки.Организация|
||ВыпускПодДеятельность = ПравилоЗагрузки.ВыпускПодДеятельность|
||ВидЦены = ПравилоЗагрузки.ВидЦены|
||Валюта = ВидЦены.ВалютаЦены|
||ГруппировкаЗатрат = ПоДокументу|
|Выпуск.Номенклатура|ВыходныеИзделия.Номенклатура|
|Выпуск.партия|ВыходныеИзделия.партия|
|Выпуск.Количество|ВыходныеИзделия.Количество|
|Выпуск.Спецификация|ВыходныеИзделия.Спецификация|
||ВыходныеИзделия.НаправлениеВыпуска = ВыпускПродукцииНаСклад|
|Выпуск.СкладВнешнейИБ|ВыходныеИзделия.Получатель|
||ВыходныеИзделия.НомерГруппыЗатрат = 1|
|Выпуск.Номенклатура|ПобочныеИзделия.Номенклатура|
|Выпуск.партия|ПобочныеИзделия.партия|
|Выпуск.Количество|ПобочныеИзделия.Количество|
||ПобочныеИзделия.НаправлениеВыпуска = ВыпускПродукцииНаСклад|
|Выпуск.СкладВнешнейИБ|ПобочныеИзделия.Получатель|
||ПобочныеИзделия.НомерГруппыЗатрат = 1|
||ПобочныеИзделия.Подразделение = Подразделение|
|РаспределениеМатериалов.Номенклатура|МатериалыИРаботы.Номенклатура|
|РаспределениеМатериалов.партия|МатериалыИРаботы.партия|
|РаспределениеМатериалов.Количество|МатериалыИРаботы.Количество|
|РаспределениеМатериалов.СкладВнешнейИБ|МатериалыИРаботы.Склад|
||МатериалыИРаботы.НомерГруппыЗатрат = 1|
||МатериалыИРаботы.Подразделение = Подразделение|

!!! info ""

    * Если документ не помечен на удаление, то он проводится.
    * Если номенклатура из строки выпуска имеет вид номенклатуры из Правила загрузки - виды номенклатуры с фиксированной стоимостью, то такая строка попадает в табличную часть побочные изделия, иначе в табличную часть выходные изделия.

Сопоставление реквизитов объектов **"Акт переработки"** и **"Движение продукции и материалов"**.

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Дата|Дата|
|Проведен|Проведен|
||ХозяйственнаяОперация = ПередачаМатериаловВКладовую|
|Ссылка|ДокументОснование|
|РаспределениеМатериалов.СкладВнешнейИБ|Отправитель|
|РабочийЦентр.Склады[0].Склад|Получатель|
||Организация = ПравилоЗагрузки.Организация|
||ВариантПриемкиТоваров = ПравилоЗагрузки.ВариантПриемкиТоваров|
|РаспределениеМатериалов.Номенклатура|Товары.Номенклатура|
|РаспределениеМатериалов.партия|Товары.партия|
|РаспределениеМатериалов.Количество|Товары.Количество|

!!! info ""

    * Создается столько документов, сколько складов в Акте переработки в табличной части Распределение материалов.
    * Поиск уже созданных документов происходит по реквизиту ДокументОснование, который равен документу ПроизводствоБезЗаказа.
    * При выгрузке склады подменяются на к2СкладыВнешнихИБОбменДаннымиИБ.
    * Документы, найденные по реквизиту ДокументОснование, которые были загружены ранее, но не загружались в текущем обмене - помечаются на удаление.

В правиле выгрузки указываются подразделение рабочего центра и дата, дата документа должна быть больше даты начала обмена в правиле выгрузки.

### Инвентаризация

Документ **"Инвентаризация"** загружается в документ **"Пересчет товаров"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
|Склад|Склад|
|Статус|Статус|
||УчетныеДанныеЗаполнены = Истина|
|Товары.Номенклатура|Товары.Номенклатура|
|Товары.партия|Товары.партия|
|Товары.КоличествоУчет|Товары.Количество|
|Товары.КоличествоФакт|Товары.КоличествоФакт|

В правиле выгрузки указывается дата, дата документа должна быть больше даты начала обмена в правиле выгрузки.

!!! info ""

    При загрузке статус из MES4FOOD *Запланировано* и *К выполнению* заменяется на *Подготовлено*

### Списание товаров

Документ **"Списание товаров"** загружается в документ **"Внутреннее потребление товаров"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
|Склад|Склад|
|Подразделение|Подразделение|
|Основание|ДокументОснование|
||Организация = ПравилоЗагрузки.Организация|
||ВидЦены = ПравилоЗагрузки.ВидЦены|
||ХозяйственнаяОперация = СписаниеТоваровПоТребованию|
Товары.Номенклатура|Товары.Номенклатура|
Товары.Количество|Товары.Количество|
||Товары.АналитикаРасходов = ПравилоЗагрузки.АналитикаРасходов|
||Товары.СтатьяРасходов = ПравилоЗагрузки.СтатьяРасходов|
|Товары.Номенклатура|партии.Номенклатура|
|Товары.партия|партии.партия|
|Товары.Количество|партии.Количество|

В правиле выгрузки указывается дата, дата документа должна быть больше даты начала обмена в правиле выгрузки.

!!! info ""

    При выгрузке склады подменяются на к2СкладыВнешнихИБОбменДаннымиИБ

### Оприходование товаров

Документ **"Оприходование товаров"** загружается в документ **"Прочее оприходование товаров"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|Ссылка|Ссылка|
|Дата|Дата|
||Номер = УстановитьНовыйНомер()|
||_Отправитель = к2_инт_ВнешниеБазыОбменДаннымиИБ|
|Представление|_ОтправленныйОбъектПредставление|
|ПометкаУдаления|ПометкаУдаления|
|Проведен|Проведен|
||ХозяйственнаяОперация = ОприходованиеЗаСчетДоходов|
|Склад|Склад|
|Основание|ДокументОснование|
|Валюта|Валюта|
||Организация = ПравилоЗагрузки.Организация|
||ВидЦены = ПравилоЗагрузки.ВидЦены|
|Подразделение|Подразделение|
|Товары.Номенклатура|Товары.Номенклатура|
|Товары.Количество|Товары.Количество|
|Товары.Цена|Товары.Цена|
|Товары.Сумма|Товары.Сумма|
||Товары.СтатьяРасходовДоходов = ПравилоЗагрузки.СтатьяДоходов|
||Товары.АналитикаДоходов = ПравилоЗагрузки.АналитикаДоходов|
|Товары.Номенклатура|партии.Номенклатура|
|Товары.партия|партии.партия|
|Товары.Количество|партии.Количество|

В правиле выгрузки указывается дата, дата документа должна быть больше даты начала обмена в правиле выгрузки.

!!! info ""

    При выгрузке склады подменяются на к2СкладыВнешнихИБОбменДаннымиИБ

## Регистры

### Запрещенные для редактирования документы обмен данными ИБ

Данные из регистра сведений **"Запрещенные для редактирования документы обмен данными ИБ"** загружаются в регистр сведений **"Запрещенные для редактирования документы обмен данными ИБ"** базы ERP.

Сопоставление реквизитов объектов:

|Реквизит MES4FOOD|Реквизит ERP|
|----------|---------|
|ОбъектИБ|ОбъектИБ|
|ДатаЗапрета|ДатаЗапрета|

Для объектов, полученных из внешней ИБ.

[1]: ObjectsUnloadedFromMES4FOOD.assets/1.png
[2]: ObjectsUnloadedFromMES4FOOD.assets/1.gif